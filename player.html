<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title id="pageTitle">Prime Moviz</title>
    <style>
    /* --- YouTube Style White Theme Variables (Standard YouTube) --- */
    :root {
        --primary-color: #0f0f0f; /* Black for icons, primary actions */
        --yt-red: #ff0000;
        --secondary-color: #606060; /* Gray for muted text */
        --bg-color: #ffffff; /* Pure white background (Body) */
        --card-bg: #ffffff; /* White card/header background */
        --text-color: #0f0f0f; /* Darkest text (Black) */
        --text-muted: #606060; /* Gray muted text */
        --button-bg-light: #f0f0f0; /* Light gray button background */
        --button-hover: #e5e5e5; /* Slightly darker hover color */
        --link-color: #065fd4; /* Standard YouTube Blue for links */
    }

    body {
        font-family: 'Roboto', sans-serif;
        background-color: var(--bg-color); 
        color: var(--text-color); 
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }
    
    a {
        text-decoration: none;
        color: var(--text-color);
    }

    .main-content {
        max-width: 100%;
        margin: 0 auto;
        padding-bottom: 30px; 
    }
    
    /* --- Video Player Container (No change) --- */
    .video-player-wrapper {
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        position: relative;
        background-color: #000;
    }
    
    .video-player-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        z-index: 10;
    }

    /* --- Loading Spinner (No change) --- */
    .loader {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.9); 
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 20;
        flex-direction: column;
    }

    .spinner {
        border: 4px solid #ccc; 
        border-top: 4px solid var(--primary-color); 
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* --- Content Details & Title Section (No change) --- */
    .content-details {
        padding: 15px; 
    }

    .content-details h1 {
        color: var(--text-color);
        font-size: 1.25em; 
        font-weight: 600; 
        margin: 0;
        padding: 0;
        line-height: 1.3;
        margin-bottom: 5px; 
        cursor: pointer;
    }
    
    /* View Count & See More Container (No change) */
    .view-count-row {
        display: flex;
        justify-content: flex-end; 
        align-items: center;
        margin-bottom: 15px;
        min-height: 20px; 
    }

    .view-count-text {
        display: none; 
    }

    /* See More Button (No change) */
    #descriptionTrigger {
        color: var(--link-color); 
        font-size: 0.85em; 
        background: none; 
        border: none; 
        padding: 0; 
        cursor: pointer;
        display: block; 
        font-weight: 500;
        margin-left: auto; 
    }
    
    /* --- Action Buttons (No change) --- */
    .action-bar-container {
        display: flex;
        justify-content: flex-start;
        gap: 12px;
        padding: 0;
        margin-bottom: 15px;
    }

    .action-button {
        background: var(--button-bg-light);
        border: none;
        color: var(--text-color);
        cursor: pointer;
        padding: 8px 15px; 
        border-radius: 20px; 
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
        font-size: 0.9em;
        gap: 5px;
        flex-shrink: 0;
    }
    
    #shareButton, #downloadButton {
        background-color: var(--primary-color); 
        color: var(--card-bg); 
    }

    /* --- Channel/Author Section --- */
    .channel-section {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-top: 1px solid #f0f0f0;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 15px;
    }

    /* UPDATED: Added box-shadow for logo clarity */
    .channel-avatar img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
        flex-shrink: 0;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .channel-info h3 {
        margin: 0;
        font-size: 1em;
        /* Bolder font for channel name */
        font-weight: 700; 
        color: var(--text-color);
    }

    /* Best movie text style */
    #bestMovieText {
        display: block;
        margin: 0;
        font-size: 0.8em;
        color: var(--text-muted);
    }

    /* Hiding the original p#subscriberCount element */
    .channel-info p {
        display: none; 
    }
    
    .subscribe-button {
        margin-left: auto;
        padding: 8px 15px;
        background-color: var(--yt-red);
        color: #ffffff;
        font-weight: bold;
        border-radius: 20px;
        font-size: 0.9em;
        cursor: pointer;
        flex-shrink: 0;
        border: none;
        text-decoration: none;
        display: inline-block;
        line-height: 1.2;
    }

    /* --- Description Modal --- */
    .description-modal {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: calc(100vh - 56.25vw); 
        max-height: 90vh; 
        background-color: var(--bg-color);
        z-index: 2000;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
        display: flex;
        flex-direction: column;
        box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
        /* Add transition for drag effect */
        will-change: transform; 
    }

    .description-modal.active {
        transform: translateY(0);
    }
    
    /* Modal Header to align close button right */
    .modal-header {
        display: flex;
        justify-content: space-between; 
        align-items: center;
        padding: 0 15px; 
        padding-top: 5px; 
        border-bottom: 1px solid #f0f0f0;
        flex-shrink: 0;
        min-height: 50px; 
        position: relative; 
    }
    
    /* Handle/Slider for Pull-to-Close */
    .modal-handle {
        width: 40px;
        height: 4px;
        background-color: #ccc;
        border-radius: 2px;
        position: absolute;
        top: 8px; 
        left: 50%;
        transform: translateX(-50%);
        cursor: grab;
    }
    
    .close-button {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-muted);
        padding: 15px 0; 
        margin-left: auto; 
    }
    
    .modal-title-text {
        font-size: 1.2em;
        font-weight: 500;
        padding: 15px 0; 
    }

    .modal-content {
        padding: 0 15px 15px 15px; 
        flex-grow: 1;
        overflow-y: auto;
    }

    .modal-content p {
        white-space: pre-wrap;
    }
    
    /* Style for ALL links, emails, and hashtags inside description */
    .modal-content a, .modal-content .hashtag {
        color: var(--link-color); 
        text-decoration: none;
    }

    /* --- Link Copied Animation (Hidden) --- */
    #copyFeedback {
        display: none; /* Hide the link copied message */
    }

    /* --- Related Videos Section (No change) --- */
    .related-videos-section {
        padding: 0 15px;
        margin-top: 30px;
    }

    .related-card {
        display: flex; 
        border: none; 
    }
    
    .related-card-thumbnail-container {
        width: 40%; 
        max-width: 160px;
        flex-shrink: 0;
        height: 90px; 
        position: relative;
    }

    .related-card-thumbnail {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; 
        border-radius: 4px;
    }

    .related-card-details {
        flex-grow: 1;
        padding-left: 8px; 
        min-width: 0; 
    }

    .related-card-title {
        font-size: 0.9em; 
        font-weight: 500; 
        line-height: 1.3; 
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        margin-bottom: 5px;
    }
    
    /* Related Channel Info Style */
    .related-channel-name {
        font-size: 0.8em;
        color: var(--text-muted);
        margin: 0;
        line-height: 1.2;
        display: block; 
    }
</style>
<script src="https://pl27826264.effectivegatecpm.com/1a/91/83/1a918398f2501ec4856526bbb3e38627.js"></script>
</head>
<body>

    <div class="main-content">
        <div class="video-player-wrapper">
            <div id="videoLoader" class="loader">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 15px;">Video is loading, please wait...</p>
            </div>
            <iframe id="videoFrame" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="display:none;"></iframe>
        </div>
        
        <div class="content-details">
            <h1 id="videoTitleDisplay">Video Loading...</h1>
            
            <div class="view-count-row">
                <span id="viewCountDisplay" class="view-count-text"></span> 
                <button id="descriptionTrigger" style="display:none;">
                    See More
                </button>
            </div>
            
            <p id="errorMessage" style="color:var(--yt-red); display:none; font-weight:bold; margin:0 0 15px 0;"></p>

            <div class="action-bar-container">
                <button id="shareButton" class="action-button" title="Share">
                    <svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                        <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/>
                    </svg>
                    <span>Share</span>
                </button>
                <button id="downloadButton" class="action-button" title="Download">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2z"/>
                    </svg>
                    <span>Download</span>
                </button>
            </div>
        </div>

        <div class="channel-section">
            <div class="channel-avatar">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOvZbUbROccttkrrmZo2qhNVr5KpNzbuKWb5UWBt5gz4A5HUuR_KOIyIOF&s=10" alt="OnFlix Logo">
            </div>
            <div class="channel-info">
                <h3 id="channelName">Viral Video +</h3>
                <p id="bestMovieText">Subscribe for all latest update </p>
                <p id="subscriberCount" style="display:none;"></p> 
            </div>
            <a href="https://t.me/bdvirallink2k26" target="_blank" rel="noopener noreferrer" class="subscribe-button">Subscribe</a>
        </div>
        
        <div class="related-videos-section" style="display:none;" id="relatedVideosSection">
            <h2>Related Videos</h2>
            <div class="related-video-grid" id="relatedVideoGrid">
                </div>
        </div>
    </div>
    
    <div id="copyFeedback"></div> 

    <div id="descriptionModal" class="description-modal">
        <div class="modal-header">
            <div class="modal-handle"></div> <h2 class="modal-title-text">Description</h2>
            <button class="close-button" id="closeModalButton">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.88a.996.996 0 1 0 1.41-1.41L13.41 12l4.88-4.89c.38-.38.38-1.02 0-1.4z"/>
                </svg>
            </button>
        </div>
        <div class="modal-content">
            <h3 id="modalTitle" style="font-weight: 500; font-size: 1.1em;">Video Title Here</h3>
            <p id="modalDescriptionContent" style="margin-top: 10px;">No description available.</p> 
        </div>
    </div>

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // --- Firebase Configuration & Setup ---
        const firebaseConfig = {
            apiKey: "AIzaSyBwgMG6fOHbI43bNkB6ZwylvBDmt7Kr7Hk",
            authDomain: "service-59f79.firebaseapp.com",
            projectId: "service-59f79",
            storageBucket: "service-59f79.firebasestorage.app",
            messagingSenderId: "893383656987",
            appId: "1:893383656987:web:32d37e8bbf7ede8a17dabe",
            measurementId: "G-4ZC155ZC6L"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const videosRef = ref(database, 'videos');
        // --- Firebase Setup End ---
        
        // --- DOM Elements ---
        const videoFrame = document.getElementById('videoFrame');
        const videoTitleDisplay = document.getElementById('videoTitleDisplay');
        const errorMessage = document.getElementById('errorMessage');
        const pageTitle = document.getElementById('pageTitle');
        const videoLoader = document.getElementById('videoLoader');
        const relatedVideosSection = document.getElementById('relatedVideosSection');
        const relatedVideoGrid = document.getElementById('relatedVideoGrid');
        const descriptionTrigger = document.getElementById('descriptionTrigger');
        
        // --- Modal Elements ---
        const descriptionModal = document.getElementById('descriptionModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const modalTitle = document.getElementById('modalTitle');
        const modalDescriptionContent = document.getElementById('modalDescriptionContent');
        const modalHandle = document.querySelector('.modal-handle');
        
        // --- Action Elements ---
        const shareButton = document.getElementById('shareButton');
        const downloadButton = document.getElementById('downloadButton'); 

        // --- Globals ---
        let allVideos = []; 
        let currentDescription = 'No description available.'; 

        // --- Utility Functions ---
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        
        function createRelatedVideoCard(video) {
            const card = document.createElement('a');
            card.href = `player.html?key=${video.key}`; 
            card.className = 'related-card';
            
            const mockChannel = 'OnFlix'; 

            card.innerHTML = `
                <div class="related-card-thumbnail-container">
                    <img src="${video.thumbnailURL}" alt="${video.title}" class="related-card-thumbnail" onerror="this.onerror=null;this.src='https://via.placeholder.com/160x90.png?text=Thumbnail';">
                </div>
                <div class="related-card-details">
                    <h3 class="related-card-title">${video.title}</h3>
                    <p class="related-channel-name">${mockChannel}</p>
                </div>
            `;
            return card;
        }

        // Function to process description for links, hashtags, and emails (STRONGER LINK DETECTION)
        function formatDescription(text) {
            // First, escape HTML special characters to prevent injection/breakage from raw user input
            let formattedText = text.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[m];
            });

            // 1. Process #hashtags (only re-link them)
            formattedText = formattedText.replace(/#([\w\u0980-\u09FF]+)/g, '<span class="hashtag">#$1</span>');
            
            // 2. Process Email Addresses (mailto: link)
            formattedText = formattedText.replace(
                /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6})/g,
                '<a href="mailto:$1" target="_blank" rel="noopener noreferrer">$1</a>'
            );
            
            // 3. Process URLs (must be done last)
            // Regex to match URLs starting with http/https/ftp OR www. OR t.me/ OR just a domain followed by a path/file 
            // The goal is to catch almost any common web link.
            const urlRegex = /(\b(?:https?:\/\/|www\.|t\.me\/)[^\s/$.?#].[^\s]*|\b[a-zA-Z0-9-]+\.(?:com|net|org|co|in|bd)\/[^\s]*)/gi;
            
            formattedText = formattedText.replace(
                urlRegex,
                (match) => {
                    // Check if the match is already part of the mailto link (shouldn't happen with the first regex but safety first)
                    if (match.includes('@')) return match; 
                    
                    let url = match;
                    // Prepend https:// if it lacks protocol (starts with www. or t.me/)
                    if (!url.match(/^https?:\/\//i)) {
                         url = 'https://' + url; 
                    }
                    return `<a href="${url}" target="_blank" rel="noopener noreferrer">${match}</a>`;
                }
            );

            // Re-convert newlines back to <br> for pre-wrap effect in the modal
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            return formattedText;
        }
        
        // --- Modal/Description Logic (UPDATED for Pull-to-Close) ---
        let isDragging = false;
        let startY = 0;
        let dragY = 0;
        
        function openDescriptionModal(title, descriptionHtml) {
            modalTitle.textContent = title;
            modalDescriptionContent.innerHTML = descriptionHtml;
            descriptionModal.classList.add('active');
            document.body.style.overflow = 'hidden'; 
            descriptionModal.style.transform = 'translateY(0)';
        }

        function closeDescriptionModal() {
            descriptionModal.classList.remove('active');
            document.body.style.overflow = ''; 
            descriptionModal.style.transform = 'translateY(100%)';
        }

        // Drag start listeners (Mouse and Touch)
        modalHandle.addEventListener('mousedown', startDrag);
        modalHandle.addEventListener('touchstart', startDrag, { passive: true });
        
        // Use the modal itself for touch drag, as it's the main area
        descriptionModal.addEventListener('touchstart', startDrag, { passive: true });

        function startDrag(e) {
            // Check if touch starts on modal-handle OR modal-header for full drag experience
            const isHandleOrHeader = e.target.classList.contains('modal-handle') || e.target.closest('.modal-header');
            
            // Allow drag only if the touch starts near the handle/header or if the content is at the top
            if (e.type === 'touchstart' && !isHandleOrHeader && modalContent.scrollTop > 0) {
                 return; // Prevent accidental closing while scrolling content
            }

            isDragging = true;
            // Get the starting Y coordinate
            startY = e.touches ? e.touches[0].clientY : e.clientY; 
            
            // Add global move/end listeners when drag starts
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', onDrag, { passive: false });
            document.addEventListener('touchend', endDrag);
            
            descriptionModal.style.transition = 'none'; // Remove transition during drag
        }

        function onDrag(e) {
            if (!isDragging) return;
            
            // Get current Y position
            const currentY = e.touches ? e.touches[0].clientY : e.clientY;
            dragY = currentY - startY;
            
            // Only allow dragging downwards (i.e., dragY > 0)
            if (dragY < 0) {
                dragY = 0;
            }
            
            descriptionModal.style.transform = `translateY(${dragY}px)`;
            
            // Prevent scrolling on the page while dragging the modal (for touch events)
            if (e.cancelable && e.type === 'touchmove') {
                e.preventDefault();
            }
        }

        function endDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            descriptionModal.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)'; // Restore transition
            
            // Determine if the modal should close (if dragged down more than 100px)
            if (dragY > 100) {
                closeDescriptionModal();
            } else {
                // Snap back to top
                descriptionModal.style.transform = 'translateY(0)';
            }
            
            dragY = 0;
            
            // Remove global listeners
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', onDrag, { passive: false });
            document.removeEventListener('touchend', endDrag);
        }

        closeModalButton.addEventListener('click', closeDescriptionModal);
        
        videoTitleDisplay.addEventListener('click', () => {
             if (currentDescription && currentDescription.trim().length > 0) {
                 openDescriptionModal(videoTitleDisplay.textContent, currentDescription);
             }
        });
        
        descriptionTrigger.addEventListener('click', () => {
             if (currentDescription && currentDescription.trim().length > 0) {
                 openDescriptionModal(videoTitleDisplay.textContent, currentDescription);
             }
        });

        
        // --- Share & Link Copy Logic (Hidden Feedback - No Change) ---
        async function copyVideoLink() {
            const videoKey = getQueryParam('key');
            if (!videoKey) return;
            const videoLink = `${window.location.origin}${window.location.pathname}?key=${videoKey}`;
            
            try {
                if (navigator.share) {
                    await navigator.share({
                        title: document.title,
                        url: videoLink,
                    });
                } else {
                    await navigator.clipboard.writeText(videoLink);
                }

            } catch (err) {
                console.error('Failed to share or copy text: ', err);
            }
        }

        shareButton.addEventListener('click', copyVideoLink);

        // --- Download Button Logic (Unchanged) ---
        function handleDownload(downloadUrl) {
            if (downloadUrl && downloadUrl.startsWith('http')) {
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('Sorry, no download link is available for this video.');
            }
        }
        
        // --- Related Videos Logic (Unchanged) ---
        function loadRelatedVideos(currentKey, currentCategory) {
            if (!currentCategory) {
                 relatedVideosSection.style.display = 'none';
                 return;
            }
             
             const relatedVideos = allVideos.filter(video =>
                video.category && video.category === currentCategory && video.key !== currentKey
             );
            
            if (relatedVideos.length > 0) {
                relatedVideoGrid.innerHTML = '';
                relatedVideos.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)).slice(0, 10).forEach(video => {
                    relatedVideoGrid.appendChild(createRelatedVideoCard(video));
                });
                relatedVideosSection.style.display = 'block';
            } else {
                 relatedVideosSection.style.display = 'none';
            }
        }


        // --- Core Video Load Logic (V9 Modular - Unchanged) ---
        async function loadVideoData() {
            const videoKey = getQueryParam('key');
            
            if (!videoKey) {
                videoLoader.style.display = 'none';
                videoTitleDisplay.textContent = 'Invalid Link';
                errorMessage.textContent = 'The link is incorrect. Please use a link with a valid video ID.';
                errorMessage.style.display = 'block';
                return;
            }
            
            videoLoader.style.display = 'flex';

            try {
                const allVideosSnapshot = await get(videosRef);
                const allVideosData = allVideosSnapshot.val();
                
                const videosArray = [];
                let videoData = null;

                if (allVideosData) {
                    for (let key in allVideosData) {
                        if (allVideosData.hasOwnProperty(key)) {
                            const video = { key: key, ...allVideosData[key] };
                            videosArray.push(video);
                            if (key === videoKey) {
                                videoData = video;
                            }
                        }
                    }
                }
                
                allVideos = videosArray; 
                
                if (videoData && videoData.embedLink) {
                    const title = videoData.title || 'No Title';
                    const category = videoData.category || ''; 
                    const downloadLink = videoData.downloadLink;

                    videoTitleDisplay.textContent = title;
                    
                    const descriptionText = videoData.description || '';
                    // Use the updated formatDescription function
                    const formattedDesc = formatDescription(descriptionText);
                    currentDescription = formattedDesc; 
                    
                    if (descriptionText.trim().length > 0) {
                        descriptionTrigger.style.display = 'block';
                    } else {
                        descriptionTrigger.style.display = 'none';
                    }

                    pageTitle.textContent = title + ' | OnFlix';
                    
                    let embedUrl = videoData.embedLink;
                    const youtubeMatch = embedUrl.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=))([\w-]{11})/i);
                    
                    if (youtubeMatch) {
                        embedUrl = `https://www.youtube.com/embed/${youtubeMatch[1]}?autoplay=1&rel=0&controls=1`;
                    }
                    
                    videoFrame.onload = function() {
                        videoLoader.style.display = 'none';
                        videoFrame.style.display = 'block';
                    };

                    videoFrame.src = embedUrl;

                    // Setup download button
                    if (downloadLink && downloadLink.startsWith('http')) {
                         downloadButton.onclick = () => handleDownload(downloadLink);
                         downloadButton.style.opacity = '1'; 
                         downloadButton.disabled = false;
                    } else {
                         downloadButton.onclick = () => alert('Sorry, no download link is available for this video.');
                         downloadButton.style.opacity = '0.5'; 
                         downloadButton.disabled = true;
                    }

                    // Load Related Videos
                    loadRelatedVideos(videoKey, category); 

                } else {
                    videoLoader.style.display = 'none';
                    videoTitleDisplay.textContent = 'Video Load Failed';
                    errorMessage.textContent = 'No data or embed link found for this video.';
                    errorMessage.style.display = 'block';
                    pageTitle.textContent = 'Error';
                }

            } catch (error) {
                 console.error("Firebase read failed:", error);
                 videoLoader.style.display = 'none';
                 videoTitleDisplay.textContent = 'Database Error';
                 errorMessage.textContent = `Problem loading data: ${error.message}`;
                 errorMessage.style.display = 'block';
                 pageTitle.textContent = 'Error';
            }
        }
        
        loadVideoData();
    </script>
    <script src="https://pl27839228.effectivegatecpm.com/76/73/9b/76739b36ed6d9c5c41b26e1c1304bcf8.js"></script>
</body>
</html>

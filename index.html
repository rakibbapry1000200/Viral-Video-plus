<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>OnFlix - Movie</title>
    
<style>
    /* --- YouTube Style Dark Theme Variables --- */
    :root {
        --primary-color: #ffffff; /* White for icons, primary actions, and line accents */
        --secondary-color: #aaaaaa; /* Light Gray for muted text and links */
        --bg-color: #0f0f0f; /* Darkest black background (Body) */
        --card-bg: #212121; /* Dark card/header background */
        --text-color: #ffffff; /* White text */
        --text-muted: #aaaaaa; /* Light Gray muted text */
        --shadow-light: none; /* Shadows removed for dark mode */
        --shadow-dark: none; /* Shadows removed for dark mode */
        --link-color: #ffffff; /* Links are white */
        --button-bg-light: #303030; /* Dark gray input/button background */
        --button-hover: #444444; /* Slightly lighter hover color for hover effects */
        --slider-shadow: 0 0 10px rgba(255, 255, 255, 0.1); /* Subtle white shadow for depth */
    }

    body {
        font-family: 'Roboto', sans-serif;
        background-color: var(--bg-color); /* Dark Black */
        color: var(--text-color); /* White */
        margin: 0;
        padding: 0;
        overflow-x: hidden !important;
        min-width: 100vw;
        touch-action: pan-y;
        -webkit-font-smoothing: antialiased;
    }

    *, *::before, *::after {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    a {
        text-decoration: none;
        color: var(--link-color); /* White Link Color */
    }

    /* Header Styles */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: var(--card-bg); /* Dark Card BG */
        box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1); /* Subtle Bottom Border */
        position: sticky;
        top: 0;
        z-index: 1000;
        width: 100%;
        max-width: 100vw;
        border-bottom: 1px solid #3a3a3a; /* Dark Separator */
    }

    /* --- UPDATED LOGO STYLE START --- */
    .logo a {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 45px;
        width: 45px;
        border-radius: 50%;
        background-color: var(--card-bg); /* Dark Card BG */
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1), 0 1px 2px rgba(255, 255, 255, 0.05);
        padding: 0;
        overflow: hidden;
        flex-shrink: 0;
    }
    .logo a img {
        height: 100%;
        width: 100%;
        object-fit: cover;
        border-radius: 50%;
    }
    /* --- UPDATED LOGO STYLE END --- */

    /* Back Button Style (White Icon) */
    .back-button {
        display: none;
        cursor: pointer;
        padding: 5px;
        margin-right: 10px;
        transition: opacity 0.2s;
        flex-shrink: 0;
    }
    .back-button svg {
        fill: var(--text-color); /* White Icon */
        width: 24px;
        height: 24px;
    }
    .back-button:hover {
        opacity: 0.8;
    }
    .back-button.visible {
        display: block;
    }

    /* Search Styles */
    .search-container {
        position: relative;
        flex-grow: 1;
        margin: 0 10px;
        display: flex;
        align-items: center;
        min-width: 0;
        transition: opacity 0.3s;
    }

    .header.in-view-mode .search-container {
        opacity: 0;
        pointer-events: none;
        margin: 0;
        flex-grow: 0;
        width: 0;
    }

    .search-wrapper {
        position: relative;
        flex-grow: 1;
    }

    .search-input {
        width: 100%;
        padding: 10px 40px 10px 15px;
        border: 1px solid #444444; /* Darker border */
        border-radius: 25px;
        background-color: var(--button-bg-light); /* Dark gray input background */
        color: var(--text-color);
        outline: none;
        transition: background-color 0.2s, box-shadow 0.2s;
        box-shadow: none;
    }

    .search-clear {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        cursor: pointer;
        color: var(--text-muted); /* Light Gray Icon */
        opacity: 0.8;
        transition: opacity 0.2s;
        display: none;
        padding: 2px;
        flex-shrink: 0;
    }

    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: var(--card-bg); /* Dark Card BG */
        border-radius: 8px;
        box-shadow: none; /* Removed for dark mode */
        max-height: 200px;
        overflow-y: auto;
        z-index: 500;
        margin-top: 5px;
        display: none;
        border: 1px solid #3a3a3a; /* Dark Border */
    }

    .suggestion-item {
        padding: 12px 15px;
        cursor: pointer;
        transition: background-color 0.2s;
        border-bottom: 1px solid #3a3a3a; /* Darker separator */
        font-size: 14px;
    }
    .suggestion-item:hover {
        background-color: var(--button-hover); /* Darker gray on hover */
    }

    /* Content Grid Styles (For Search Results) */
    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
        padding: 0 15px 20px 15px;
        width: 100%;
    }

    .content-grid .video-card {
        width: 100%;
        min-width: unset;
    }

    @media (min-width: 600px) {
        .content-grid {
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        }
    }
    @media (min-width: 1024px) {
        .content-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 30px 40px 30px;
        }
    }

    /* Hero Slider Styles */
    .slider-container {
        width: 100%;
        overflow: hidden;
        position: relative;
        padding-top: 56.25%;
        margin-bottom: 30px;
        box-shadow: var(--slider-shadow);
        border-radius: 10px;
        transform: translate3d(0,0,0);
    }

    .slider {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        will-change: transform;
        cursor: grab;
    }

    .slide {
        min-width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        position: relative;
        transition: opacity 0.3s;
    }

    .slider-dots {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        z-index: 10;
    }

    .dot {
        height: 10px;
        width: 10px;
        margin: 0 6px;
        background-color: var(--text-muted); /* Light Gray Dot */
        border-radius: 50%;
        display: inline-block;
        transition: background-color 0.3s, transform 0.3s;
        cursor: pointer;
        opacity: 0.7;
    }

    .dot.active {
        background-color: var(--primary-color); /* White Active Dot */
        opacity: 1;
        transform: scale(1.2);
    }

    /* Video Section Styles */
    .content-section {
        padding: 0 0 20px 0;
        width: 100%;
        overflow: hidden;
    }

    h2 {
        margin: 25px 15px 15px;
        font-size: 1.6em;
        color: var(--text-color);
        border-left: 4px solid var(--primary-color); /* White Left Accent Line */
        padding-left: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    h2 a {
        font-size: 0.6em;
        color: var(--secondary-color); /* Light Gray Link Color */
        font-weight: 500;
        margin-left: 10px;
        padding: 5px 10px;
        border: 1px solid var(--secondary-color);
        border-radius: 5px;
        transition: background-color 0.2s, color 0.2s;
        cursor: pointer;
    }
    h2 a:hover {
        background-color: rgba(255, 255, 255, 0.1); /* White hover effect */
    }

    .main-content-hidden .slider-container,
    .main-content-hidden .content-section-category {
         display: none;
    }

    /* Horizontal Slider Container for Categories */
    .horizontal-slider-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding: 0 15px 20px 15px;
        margin-bottom: 20px;
        overscroll-behavior-x: contain;
    }

    /* Hide scrollbar */
    .horizontal-slider-container::-webkit-scrollbar {
        display: none;
    }

    .horizontal-slider {
        display: flex;
        gap: 15px;
        padding-bottom: 5px;
        flex-wrap: nowrap;
    }

    .video-card {
        min-width: 140px;
        width: 140px;
        background-color: var(--card-bg); /* Dark Card BG */
        border: 1px solid #3a3a3a; /* Dark border */
        border-radius: 10px;
        box-shadow: none; /* No shadow needed in dark mode */
        transition: transform 0.3s ease-in-out, box-shadow 0.3s;
        cursor: pointer;
        flex-shrink: 0;
    }

    .video-thumbnail-container {
        width: 100%;
        padding-top: 56.25%;
        position: relative;
    }

    .video-thumbnail {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-bottom: 2px solid var(--primary-color); /* White bottom accent */
        border-top-left-radius: 9px;
        border-top-right-radius: 9px;
    }

    .video-info {
        padding: 10px;
        height: 50px;
        display: flex;
        align-items: center;
    }

    .video-title {
        font-size: 0.9em;
        font-weight: 700;
        margin: 0;
        line-height: 1.1em;
        height: 2.2em;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        text-overflow: ellipsis;
        width: 100%;
    }


    /* Static Footer Style */
    .static-footer {
        background-color: var(--bg-color); /* Dark Black */
        color: var(--text-muted);
        padding: 20px 15px;
        text-align: center;
        border-top: 1px solid #3a3a3a; /* Dark border */
        margin-top: auto;
        width: 100%;
        max-width: 100vw;
        transition: opacity 0.3s;
    }

    .footer-hidden {
         display: none;
    }

    .static-footer p {
        margin: 5px 0;
        font-size: 0.8em;
    }

    .static-footer a {
        color: var(--secondary-color); /* Light Gray Link */
        text-decoration: underline;
    }


    /* Responsive Adjustments */
    @media (min-width: 600px) {
        .video-card {
            min-width: 180px;
            width: 180px;
        }
    }

    @media (min-width: 1024px) {
        /* --- UPDATED LOGO STYLE START for Desktop --- */
        .logo a {
            height: 55px;
            width: 55px;
        }
        /* img ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        /* --- UPDATED LOGO STYLE END for Desktop --- */
        .horizontal-slider {
            gap: 20px;
        }
        .video-card {
            min-width: 220px;
            width: 220px;
        }
        .content-section {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 0 40px 0;
        }
        .horizontal-slider-container {
             padding: 0 30px 20px 30px;
        }
        h2 {
            margin: 25px 30px 15px;
        }
        .header {
            position: static;
            padding: 15px 30px;
        }
        .static-footer {
             max-width: 100%;
             margin-top: 50px;
             padding: 30px 50px;
        }
         .header.in-view-mode {
            justify-content: flex-start;
         }
         .header.in-view-mode .back-button {
            display: block;
            margin-right: 30px;
         }
         .header.in-view-mode .logo {
            display: none !important;
         }
    }
</style>
    <script>
        // Placeholder functions to avoid 'not defined' errors in HTML attributes
        window.handleSearchInput = function() { /* Logic will be in module */ };
        window.handleSearchKeyDown = function(event) { /* Logic will be in module */ };
        window.clearSearch = function() { /* Logic will be in module */ };
        window.performCategorySearch = function(categoryName) { /* Logic will be in module */ };
    </script>
    <script src="https://pl27826264.effectivegatecpm.com/1a/91/83/1a918398f2501ec4856526bbb3e38627.js"></script>
</head>
<body>

    <div class="header" id="mainHeader">
        <div class="back-button" id="backButton" onclick="clearSearch()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </div>
        <div class="logo" id="mainLogo">
            <a href="#">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOvZbUbROccttkrrmZo2qhNVr5KpNzbuKWb5UWBt5gz4A5HUuR_KOIyIOF&s=10" alt="Prime Moviz Logo"> 
            </a>
        </div>
        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="Search viral video" oninput="handleSearchInput()" onkeydown="handleSearchKeyDown(event)">
                <div class="search-clear" id="searchClearButton" onclick="clearSearch()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
                </div>
            </div>
            <div id="searchResults" class="search-suggestions">
                </div>
        </div>
    </div>

    <div class="content-section" id="mainContent">
        
        <div class="slider-container" id="sliderContainer">
            <div class="slider" id="slider">
                <p style="padding:20px; color:var(--text-muted);">Loading Sliders...</p>
            </div>
            <div class="slider-dots" id="sliderDots">
                </div>
        </div>
        
    </div>
    
    <div id="searchSection" class="content-section-category" style="display: none;">
        <h2 id="searchCategoryHeading">Search Results</h2>
        <div id="searchGrid" class="content-grid">
            </div>
    </div>

    <footer class="static-footer" id="mainFooter">
        <p>&copy; <span id="currentYear"></span> OnFlix. All rights reserved.</p>
          <p><a href="https://t.me/bdvirallink2k26">Telegram</a> | <a href="https://youtube.com/@robiulislamrakib591-b7t?si=JOt0jo-nNal5PW7l">YouTube </a></p>
    </footer>            

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        // --- Firebase Configuration & Setup ---
        const firebaseConfig = {
            apiKey: "AIzaSyBwgMG6fOHbI43bNkB6ZwylvBDmt7Kr7Hk",
            authDomain: "service-59f79.firebaseapp.com",
            projectId: "service-59f79",
            storageBucket: "service-59f79.firebasestorage.app",
            messagingSenderId: "893383656987",
            appId: "1:893383656987:web:32d37e8bbf7ede8a17dabe",
            measurementId: "G-4ZC155ZC6L"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // References for V9
        const videosRef = ref(database, 'videos');
        const slidersRef = ref(database, 'sliders');
        // --- Firebase Setup End ---


        // --- DOM Elements & Global State ---
        const slider = document.getElementById('slider');
        const sliderDotsContainer = document.getElementById('sliderDots');
        const searchInput = document.getElementById('searchInput');
        const searchResultsContainer = document.getElementById('searchResults');
        const searchSection = document.getElementById('searchSection');
        const searchGrid = document.getElementById('searchGrid');
        const searchClearButton = document.getElementById('searchClearButton');
        const backButton = document.getElementById('backButton');
        const mainLogo = document.getElementById('mainLogo');
        const mainContent = document.getElementById('mainContent');
        const sliderContainer = document.getElementById('sliderContainer');
        const searchCategoryHeading = document.getElementById('searchCategoryHeading'); 
        
        // üî• Added Header and Footer Elements
        const mainHeader = document.getElementById('mainHeader');
        const mainFooter = document.getElementById('mainFooter');

        let allVideos = [];
        let isSearchMode = false;
        const MAX_VIDEOS_PER_CATEGORY = 10; 
        
        // --- Utility Functions ---
        function playVideo(videoKey) {
            window.location.href = `player.html?key=${videoKey}`;
        }
        
        function navigateToSliderLink(clickURL) {
             if (clickURL) {
                 window.location.href = clickURL;
             }
        }

        // üî• Updated: Toggle header and footer classes based on search mode
        function toggleSearchMode(activate, headingText = "Search Results") {
            isSearchMode = activate;
            searchCategoryHeading.textContent = headingText;
            
            if (activate) {
                mainContent.classList.add('main-content-hidden');
                searchSection.style.display = 'block';
                
                // UI changes for View Mode (Search/Category)
                backButton.classList.add('visible');
                mainLogo.style.display = 'none';
                mainHeader.classList.add('in-view-mode'); // üî• Hide search bar (via CSS)
                mainFooter.classList.add('footer-hidden'); // üî• Hide footer (via CSS)
                
                sliderContainer.style.marginBottom = '0';
                window.scrollTo(0, 0); 
            } else {
                mainContent.classList.remove('main-content-hidden');
                searchSection.style.display = 'none';
                
                // UI changes for Home Mode
                backButton.classList.remove('visible');
                mainLogo.style.display = 'block';
                mainHeader.classList.remove('in-view-mode'); // üî• Show search bar
                mainFooter.classList.remove('footer-hidden'); // üî• Show footer
                
                searchInput.value = '';
                searchClearButton.style.display = 'none';
                searchResultsContainer.style.display = 'none';
                sliderContainer.style.marginBottom = '30px';
                searchGrid.innerHTML = ''; 
            }
        }

        // üî• clearSearch function is now attached to the global placeholder
        window.clearSearch = function() {
             searchInput.value = '';
             searchResultsContainer.style.display = 'none';
             searchClearButton.style.display = 'none';
             if (isSearchMode) {
                 toggleSearchMode(false);
             }
        }
        
        // --- Data Rendering: Video Card (Unchanged) ---
        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.onclick = () => playVideo(video.key);

            card.innerHTML = `
                <div class="video-thumbnail-container">
                    <img src="${video.thumbnailURL}" alt="${video.title}" class="video-thumbnail" onerror="this.onerror=null;this.src='https://via.placeholder.com/160x90.png?text=No+Image';">
                </div>
                <div class="video-info">
                    <h3 class="video-title">${video.title}</h3>
                    </div>
            `;
            return card;
        }

        // --- Search/Category Logic ---
        
        function renderVideoGrid(videos, heading, noResultsMessage) {
            searchGrid.innerHTML = ''; 
            
            if (videos.length === 0) {
                searchGrid.innerHTML = `<p style="text-align:center; color:var(--text-muted); padding: 10px 15px 0; width: 100%;">${noResultsMessage}</p>`;
            } else {
                 videos.forEach(video => {
                    searchGrid.appendChild(createVideoCard(video));
                });
            }
            toggleSearchMode(true, heading);
        }
        
        function performSearch(query) {
             const finalQuery = query.toLowerCase().trim();
             if (finalQuery.length < 1) {
                 clearSearch();
                 return;
             }
             
             const filteredVideos = allVideos.filter(video =>
                (video.title && video.title.toLowerCase().includes(finalQuery)) || 
                (video.description && video.description.toLowerCase().includes(finalQuery))
            );
            
            const heading = `Search Results: "${query}"`;
            const noResultsMessage = `No videos found matching "${query}" in the title or description.`;
            renderVideoGrid(filteredVideos, heading, noResultsMessage);
        }

        // üî• handleSearchInput logic
        window.handleSearchInput = function() {
            const query = searchInput.value.toLowerCase().trim();
            searchResultsContainer.innerHTML = '';
            searchClearButton.style.display = query.length > 0 ? 'block' : 'none';

            if (query.length < 2) {
                searchResultsContainer.style.display = 'none';
                if (query.length === 0 && isSearchMode) {
                    clearSearch();
                }
                return;
            }

            const filteredSuggestions = allVideos.filter(video =>
                video.title.toLowerCase().includes(query)
            );
            
            filteredSuggestions.slice(0, 5).forEach(video => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = video.title;
                item.onclick = (e) => {
                    e.stopPropagation(); 
                    searchInput.value = video.title;
                    performSearch(video.title);
                    searchResultsContainer.style.display = 'none';
                };
                searchResultsContainer.appendChild(item);
            });
            searchResultsContainer.style.display = filteredSuggestions.length > 0 ? 'block' : 'none';
        }
        
        // üî• handleSearchKeyDown logic
        window.handleSearchKeyDown = function(event) {
             if (event.key === 'Enter') {
                 event.preventDefault(); 
                 searchResultsContainer.style.display = 'none'; 
                 performSearch(searchInput.value);
                 searchInput.blur();
             }
        }
        
        // üî• Function to handle 'See More' for a category
        window.performCategorySearch = function(categoryName) {
            const categoryVideos = allVideos.filter(video => video.category === categoryName);
            const heading = `All Videos in: ${categoryName}`;
            const noResultsMessage = `No videos found in the category "${categoryName}".`;
            renderVideoGrid(categoryVideos, heading, noResultsMessage);
        }

        document.addEventListener('click', (event) => {
            if (!event.target.closest('.search-container')) {
                searchResultsContainer.style.display = 'none';
            }
        });
        
        // --- Slider Logic (Unchanged) ---
        let currentSlide = 0;
        let slideInterval;
        let slides = [];
        let isDragging = false;
        let startPos = 0;
        let currentTranslate = 0;
        let prevTranslate = 0;
        let animationID = 0;
        const SLIDE_THRESHOLD = 0.15;

        function setSliderPosition() {
             if (isDragging) {
                 cancelAnimationFrame(animationID);
                 animationID = requestAnimationFrame(setSliderPosition);
             }
             slider.style.transform = `translateX(${currentTranslate}px)`;
        }

        function updateSlider() {
            if (slides.length === 0) return;
            const translateValue = -currentSlide * slider.clientWidth;
            currentTranslate = translateValue;
            slider.classList.remove('no-transition');
            slider.style.transform = `translateX(${currentTranslate}px)`; 
            Array.from(sliderDotsContainer.children).forEach((dot, index) => {
                dot.classList.remove('active');
                if (index === currentSlide) {
                    dot.classList.add('active');
                }
            });
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % slides.length;
            updateSlider();
        }

        function startSlideShow() {
            clearInterval(slideInterval);
            if (slides.length > 1) {
                slideInterval = setInterval(nextSlide, 5000);
            }
        }
        
        function getPositionX(event) {
            return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
        }
        
        function dragStart(event) {
            if (slides.length === 0 || isSearchMode) return; 
            if (event.type.includes('mouse')) event.preventDefault(); 
            isDragging = true;
            startPos = getPositionX(event);
            slider.classList.add('no-transition');
            cancelAnimationFrame(animationID);
            clearInterval(slideInterval); 
            prevTranslate = -currentSlide * slider.clientWidth;
        }

        function drag(event) {
            if (!isDragging) return;
            const currentPosition = getPositionX(event);
            const diff = currentPosition - startPos;
            currentTranslate = prevTranslate + diff;
            if (!animationID) { 
                setSliderPosition();
            }
        }

        function dragEnd() {
            if (!isDragging) return;
            isDragging = false;
            cancelAnimationFrame(animationID);
            animationID = 0; 
            slider.classList.remove('no-transition');
            const movedBy = currentTranslate - prevTranslate;
            const slideWidth = slider.clientWidth;
            let newSlide = currentSlide;
            if (movedBy < -slideWidth * SLIDE_THRESHOLD && currentSlide < slides.length - 1) {
                newSlide++; 
            } else if (movedBy > slideWidth * SLIDE_THRESHOLD && currentSlide > 0) {
                newSlide--; 
            }
            currentSlide = newSlide;
            prevTranslate = -currentSlide * slideWidth;
            currentTranslate = prevTranslate; 
            updateSlider(); 
            startSlideShow();
        }

        slider.addEventListener('mousedown', dragStart);
        slider.addEventListener('mouseup', dragEnd);
        slider.addEventListener('mouseleave', dragEnd);
        slider.addEventListener('mousemove', drag);
        
        slider.addEventListener('touchstart', dragStart, {passive: true});
        slider.addEventListener('touchend', dragEnd);
        slider.addEventListener('touchmove', drag, {passive: false});


        function createSlide(sliderData) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            slide.style.backgroundImage = `url('${sliderData.thumbnailURL}')`;

            if (sliderData.clickable === 'true' && sliderData.clickURL) {
                slide.onclick = (e) => {
                    const diff = Math.abs(currentTranslate - prevTranslate);
                    if (diff < 5) { 
                        navigateToSliderLink(sliderData.clickURL);
                    }
                };
                slide.style.cursor = 'pointer';
            } else {
                slide.style.cursor = 'default';
                slide.onclick = null;
            }
            
            return slide;
        }

        function renderSlider(featuredSliders) {
            slides = featuredSliders;
            slider.innerHTML = '';
            sliderDotsContainer.innerHTML = '';
            
            if (isSearchMode) return;

            if (slides.length === 0) {
                 slider.innerHTML = '<p style="padding:20px; color:var(--text-muted); text-align:center; width:100%;">No sliders uploaded at the moment.</p>';
                 return;
            }

            featuredSliders.forEach((s, index) => {
                slider.appendChild(createSlide(s));
                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.onclick = () => { 
                    currentSlide = index; 
                    updateSlider(); 
                    startSlideShow(); 
                };
                sliderDotsContainer.appendChild(dot);
            });

            currentSlide = 0;
            prevTranslate = 0;
            currentTranslate = 0;
            updateSlider();
            startSlideShow();
        }

        // --- Category Rendering Logic (Unchanged) ---
        
        function createSection(title, categoryName, videos, totalVideos) {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'content-section-category';

            const sectionHeader = document.createElement('h2');
            const titleSpan = document.createElement('span');
            titleSpan.textContent = title;
            sectionHeader.appendChild(titleSpan);

            const seeMoreLink = document.createElement('a');
            seeMoreLink.href = "#"; 
            seeMoreLink.textContent = totalVideos > MAX_VIDEOS_PER_CATEGORY ? "See more" : "See all";
            seeMoreLink.onclick = (e) => { 
                e.preventDefault(); 
                window.performCategorySearch(categoryName); 
            }; 
            sectionHeader.appendChild(seeMoreLink);
            
            sectionDiv.appendChild(sectionHeader);

            const sliderContainer = document.createElement('div');
            sliderContainer.className = 'horizontal-slider-container';

            const videoSlider = document.createElement('div');
            videoSlider.className = 'horizontal-slider';
            
            const videosToShow = videos.slice(0, MAX_VIDEOS_PER_CATEGORY); 

            if (videosToShow.length === 0) {
                 sliderContainer.innerHTML = `<p style="text-align:center; color:var(--text-muted); padding: 10px 15px 0;">No videos found in this section.</p>`;
            } else {
                 videosToShow.forEach(video => {
                    videoSlider.appendChild(createVideoCard(video));
                });
                sliderContainer.appendChild(videoSlider);
            }
            
            sectionDiv.appendChild(sliderContainer);
            return sectionDiv;
        }

        function renderAllCategories(videos) {
            if (isSearchMode) return;
            const contentArea = document.querySelector('.content-section');
            const sliderContainer = document.getElementById('sliderContainer');
            
            const existingSections = contentArea.querySelectorAll('.content-section-category');
            existingSections.forEach(section => section.remove());
            
            const categorizedVideos = videos.reduce((acc, video) => {
                const category = video.category || 'Uncategorized';
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(video);
                return acc;
            }, {});

            let lastElement = sliderContainer;
            let hasContent = Object.keys(categorizedVideos).length > 0;
            const categories = Object.keys(categorizedVideos).sort();

            categories.forEach(categoryName => {
                const videosInCategory = categorizedVideos[categoryName];
                
                if (videosInCategory.length > 0) {
                    const section = createSection(categoryName, categoryName, videosInCategory, videosInCategory.length);
                    lastElement.insertAdjacentElement('afterend', section);
                    lastElement = section;
                }
            });

            const existingFallback = document.getElementById('noContentMessage');
            if (!hasContent && !existingFallback) {
                 const fallback = document.createElement('h2');
                 fallback.id = 'noContentMessage';
                 fallback.style.cssText = 'text-align:center; color:var(--text-muted); margin-top: 30px; border-left: none; padding-left: 0;';
                 fallback.textContent = 'No videos uploaded yet.';
                 sliderContainer.insertAdjacentElement('afterend', fallback);
            } else if (hasContent && existingFallback) {
                existingFallback.remove();
            }
        }


        // --- Data Listeners (Unchanged) ---

        // 1. Video Data Listener 
        onValue(videosRef, (snapshot) => {
            const data = snapshot.val();
            const videosArray = [];

            if (data) {
                for (let key in data) {
                    if (data.hasOwnProperty(key)) {
                        videosArray.push({
                            key: key,
                            ...data[key]
                        });
                    }
                }
            }

            allVideos = videosArray.reverse();
            
            if (!isSearchMode) {
                 renderAllCategories(allVideos);
            }
            const errorElement = document.getElementById('videoError');
            if (errorElement) errorElement.remove();

        }, (error) => {
            console.error("Firebase video read failed:", error);
            const contentArea = document.querySelector('.content-section');
            if (!document.getElementById('videoError')) {
                contentArea.insertAdjacentHTML('beforeend', '<p id="videoError" style="text-align:center; color:var(--primary-color); padding: 30px;">Problem loading videos. Check Firebase connection/rules.</p>');
            }
        });
        
        // 2. Slider Data Listener
        onValue(slidersRef, (snapshot) => {
            const data = snapshot.val();
            const slidersArray = [];

            if (data) {
                for (let key in data) {
                    if (data.hasOwnProperty(key)) {
                        slidersArray.push({
                            key: key,
                            ...data[key]
                        });
                    }
                }
            }
            
            renderSlider(slidersArray.reverse()); 
        }, (error) => {
            console.error("Firebase slider read failed:", error);
            slider.innerHTML = '<p style="padding:20px; color:var(--primary-color); text-align:center; width:100%;">Problem loading sliders.</p>';
        });
        
        // --- Initial setup (Unchanged) ---
        window.addEventListener('resize', () => {
             if (!isSearchMode) updateSlider();
        });
        
        searchSection.style.display = 'none';
        document.getElementById('currentYear').textContent = new Date().getFullYear(); 
        
    </script>
    <script src="https://pl27839228.effectivegatecpm.com/76/73/9b/76739b36ed6d9c5c41b26e1c1304bcf8.js"></script>
</body>
</html>
